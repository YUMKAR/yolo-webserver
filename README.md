# 세이프 스탭 (Safe Step)

## 📌 프로젝트 소개

**세이프 스탭(Safe Step)**은 YOLO 모델을 활용해 **사용자의 입장·퇴장을 자동으로 감지**하고, 아두이노 센서(조도, 온도, 습도, 빗물 감지)를 통해 측정한 데이터를 **라즈베리파이와 블루투스 통신으로 전달**받아 **퇴장 시 조건별 음성 메시지를 출력**하는 스마트 환경 감지 시스템입니다.

본 프로젝트는 실내 환경 변화와 사용자 동작을 연결하여 보다 안전하고 편리한 공간을 구현하는 것을 목표로 합니다.

---

## 🚀 주요 기능

* 🧍‍♂️ **YOLO 기반 입장/퇴장 감지**
* 🌡️ **온도·습도 감지 (Arduino)**
* 💡 **조도(Light) 센서 측정**
* ☔ **비 감지 센서 측정**
* 📡 **아두이노 → 라즈베리파이 블루투스 통신**
* 🔊 **퇴장 감지 시 상황별 음성 메시지 재생**
* 🖥️ **라즈베리파이 기반 메인 애플리케이션 동작**

---

## 🛠 기술 스택

* **Python** — YOLO 모델 실행 및 전체 프로그램 제어
* **C++ / Arduino** — 센서 제어 및 블루투스 송신
* **Raspberry Pi** — 메인 컨트롤러, Python 실행 환경
* **Bottle** — 센서값 응답용 API
* **YOLO 모델 (ultralytics)** — 사람 감지 / 입장·퇴장 판단

---

## 🗂 프로젝트 구조 예시

```
SafeStep/
├─ MainApp.py
├─ SerialMonitor.py
├─ YoloDetector.py
├─ Config.py
├─ weights/
│   └─ yolov8n-human.pt
├─ Arduino/
│   └─ sensor_code.ino
├─ bluetooth/
│   └─ SerialMonitor.py
├─ audio/
│   ├─ in.mp3
│   ├─ out.mp3
│   ├─ rain.mp3
│   └─ hot.mp3
└─ requirements.txt
```

---

## 🔧 설치 방법

### 1. 필수 패키지 설치

```
pip install -r requirements.txt
```

### 2. YOLO 모델 파일 준비


* `/weights` 폴더에 학습된 YOLO 모델(`.pt`) 파일을 위치시킵니다.

### 3. 아두이노 업로드

* Arduino IDE에서 `sensor_code.ino` 파일을 Arduino MegaUno에 업로드합니다.

---

## ▶️ 실행 방법

```
python MainApp.py
```

* 실행 시 YOLO 모델 로드
* 블루투스 데이터 수신 시작
* 입장/퇴장 감지 및 음성 메시지 출력 동작 시작

---

## 📊 시스템 동작 흐름도

아래는 시스템의 전체 동작 과정을 간단히 나타낸 흐름도입니다:

1. **YOLO 모델 로드** → 실시간 카메라 영상 분석
2. **사람 감지** → 입장 또는 퇴장 판별
3. **Arduino 센서 데이터 수집** → 조도/온도/습도/빗물 측정
4. **Bluetooth 전송** → 라즈베리파이로 센서 데이터 전달
5. **상태 분석** → 퇴장 시 센서 상황과 YOLO 감지 정보 조합
6. **음성 메시지 출력** → 조건별 알림 재생

---

## 🧪 센서 데이터 기준 및 활용 예시

센서 값에 따라 출력되는 메시지를 다르게 설정할 수 있습니다:

* **조도 낮음** → "불이 켜져있어요! 불을 끄고 나가주세요."
* **습도 높음** → "습도가 높습니다. 창문을 점검해주세요."
* **비 감지됨** → "밖에 비가 오고 있어요. 우산 챙기세요!"
* **온도 높음** → "방 온도가 높습니다. 환기해 주세요."

---

## 🔍 YOLO 감지 기준

* 일정 프레임 동안 사람 객체가 설정방향으로 이동하면 **퇴장으로 판정**
* 여러 인물이 감지 될 경우 중복 감지 방지
* FPS 최적화 및 성능을 위해 ultralytics YOLO 사용

---

## 📡 Bluetooth 통신 구조

Arduino → Raspberry Pi 간 통신 구조:

* BaudRate: 9600
* 전송 형식: `H: 54.2%, T: 23.7C, L: 120, R:848`
* Python 측에서 Regex 파싱

---

## 🧱 하드웨어 구성 요소

* 라즈베리파이 5
* Arduino Uno / Nano
* 조도(LDR) 센서
* DHT11 / DHT22 온습도 센서
* 빗물 감지 센서
* USB 카메라(Logitech 등)
* 아크릴 하우징 모델

---

## 💽 향후 개발 계획 (TODO)

* [ ] Sensor API를 활용한 Web Dashboard 제공
* [ ] 센서 데이터 시각화(그래프)
* [ ] MQTT 방식 무선 통신으로 확장
* [ ] YOLO 동작 FPS 최적화
* [ ] 음성 메시지 자동 생성(TTS) 기능

